<%= turbo_frame_tag "build_frame",
  class: "build-detail-inner",
  data: { turbo_action: "advance" } do %>

  <div class="build-detail-header">
    <div>
      <h2><%= @build.commit_message %></h2>
      <h3>Commit <code><%= abbreviated_hash(@build.commit_hash) %></code></h3>
    </div>

    <div class="build-detail-action-buttons">
      <%= button_to "Rerun", rebuilds_path(build_id: @build.id), method: :post, data: { turbo: false } %>
      <%= button_to "Delete", project_build_path(id: @build.id), method: :delete, data: { turbo: false } %>
    </div>
  </div>

  <div class="build-detail-content">
    <div class="terminal-container">
      <% if @build.report.present? %>
        <pre class="terminal"><%= BuildReport.new(@build.report).to_s.html_safe %></pre>
      <% end %>

      <% if @build.build_logs.any? %>
        <% @build.build_logs.each do |build_log| %>
          <pre class="terminal"><%= ansi_to_html(build_log.content) %></pre>
          <br>
        <% end %>
      <% end %>
    </div>

    <% if @build.build_events.any? %>
      <table border>
        <tr>
          <th>Time</th>
          <th>Event</th>
        </tr>

        <% @build.build_events.each do |build_event| %>
          <tr>
            <td><%= build_event.created_at %></td>
            <td><%= build_event.type %></td>
          </tr>
        <% end %>
      </table>
    <% else %>
      Waiting for build machine
    <% end %>
  </div>
<% end %>
